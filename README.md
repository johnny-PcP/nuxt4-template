# Nuxt 3 å¤§å‹å°ˆæ¡ˆé€šç”¨æ¨¡æ¿

> é©ç”¨æ–¼å¤§å‹å°ˆæ¡ˆå’Œå¤šäººå”ä½œçš„ Nuxt 3 æ¶æ§‹æ¨¡æ¿ï¼Œæ•´åˆ TypeScriptã€Zodã€ESLintï¼Œæ¡ç”¨ç¾ä»£åŒ–çµ„ä»¶è¨­è¨ˆã€‚

## å°ˆæ¡ˆæ¶æ§‹è¨­è¨ˆç†å¿µ

### 1. ä¸»è¦è³‡æ–™çµæ§‹å±¤ (`service/schema`)

- ä½¿ç”¨ Zod Schema å®šç¾©æ‰€æœ‰è³‡æ–™çµæ§‹çš„é©—è­‰è¦å‰‡
- é€é `z.infer<typeof Schema>` è‡ªå‹•æ¨å°å‡º TypeScript å‹åˆ¥
- æä¾›çµ±ä¸€çš„è³‡æ–™é©—è­‰å’Œå‹åˆ¥å®šç¾©ä¾†æº

### 2. API æœå‹™å±¤ (`service/api`)

- å»ºç«‹ API æœå‹™é¡åˆ¥ï¼ŒåŒ…å«å°æ‡‰çš„ API æ–¹æ³•
- **è¼¸å…¥é©—è­‰**ï¼šAPI æ–¹æ³•çš„åƒæ•¸ä½¿ç”¨ Zod Schema é€²è¡Œé©—è­‰
- **è¼¸å‡ºé©—è­‰**ï¼šAPI æ–¹æ³•çš„å›å‚³è³‡æ–™ä½¿ç”¨ Zod Schema é€²è¡Œé©—è­‰
- ç¢ºä¿æ‰€æœ‰ API æ–¹æ³•è¿”å›çš„è³‡æ–™éƒ½æ˜¯å·²é©—è­‰çš„å‹åˆ¥å®‰å…¨è³‡æ–™

### 3. æ¥­å‹™é‚è¼¯å±¤ (`composables`)

- ä½¿ç”¨ `service/api` çš„æ–¹æ³•ä¾†è™•ç†è³‡æ–™ç²å–å’Œæ¥­å‹™é‚è¼¯
- æ•´åˆå¤šå€‹ API æœå‹™ï¼Œæä¾›æ›´é«˜éšçš„æ¥­å‹™åŠŸèƒ½
- è¿”å› reactive çš„è³‡æ–™ç‹€æ…‹å’Œæ“ä½œæ–¹æ³•
- æ‰€æœ‰è¿”å›çš„è³‡æ–™éƒ½å·²é€šé Schema é©—è­‰ï¼Œä¿è­‰å‹åˆ¥å®‰å…¨

### 4. çµ„ä»¶å±•ç¤ºå±¤ (`components`)

- **åˆ†çµ„åŸå‰‡**ï¼šæŒ‰ç…§ä¸»è¦æ¥­å‹™å¯¦é«”åˆ†çµ„ï¼ˆå¦‚ `user/`ã€`product/`ã€`order/` ç­‰ï¼‰
- **å‹åˆ¥å®šç¾©**ï¼šçµ„ä»¶çš„ Props å’Œ Emits å‹åˆ¥ç›´æ¥å®šç¾©åœ¨ `.vue` æª”æ¡ˆä¸­
- **æ··åˆåŠŸèƒ½çµ„ä»¶**ï¼šæ ¹æ“šä¸»è¦æœå‹™å°è±¡åˆ†é¡
  - ä¾‹å¦‚ï¼š`UserProductList.vue`ï¼ˆé¡¯ç¤ºç”¨æˆ¶çš„å•†å“ï¼‰æ”¾åœ¨ `components/user/` ä¸‹
  - ä¾‹å¦‚ï¼š`ProductOrderHistory.vue`ï¼ˆé¡¯ç¤ºå•†å“çš„è¨‚å–®æ­·å²ï¼‰æ”¾åœ¨ `components/product/` ä¸‹
- **é€šç”¨çµ„ä»¶**ï¼šä¸ç‰¹å®šæ–¼ä»»ä½•æ¥­å‹™å¯¦é«”çš„çµ„ä»¶æ”¾åœ¨ `components/shared/` ä¸‹

### 5. é é¢çµ„è£å±¤ (`pages`)

- çµ„åˆå¤šå€‹ composables å’Œ components ä¾†æ§‹å»ºå®Œæ•´é é¢
- è™•ç†è·¯ç”±ç›¸é—œé‚è¼¯å’Œé é¢ç´šåˆ¥çš„ç‹€æ…‹ç®¡ç†

### è³‡æ–™æµå‘

```
Schema (å®šç¾©) â†’ API Service (é©—è­‰) â†’ Composable (æ¥­å‹™é‚è¼¯) â†’ Component (å±•ç¤º) â†’ Page (çµ„è£)
```

## âš ï¸ é‡è¦æé†’

### 1. å·²ç¦ç”¨è‡ªå‹•å°å…¥

**æ‰€æœ‰ Vueã€Nuxt å’Œç¬¬ä¸‰æ–¹å‡½æ•¸éƒ½å¿…é ˆæ‰‹å‹•å°å…¥**

```typescript
import { useRuntimeConfig } from '#app'
import { ref } from 'vue'
import { useRoute } from 'vue-router'

// âœ… æ­£ç¢º - å¿…é ˆæ‰‹å‹•å°å…¥
const config = useRuntimeConfig()
const route = useRoute()
const data = ref([])
```

### 2. API è·¯å¾‘è¨­å®š

**`NUXT_PUBLIC_IS_USE_LOCAL_API` æ±ºå®š API å‘¼å«è·¯å¾‘ï¼š**

- âœ… `true`ï¼šä½¿ç”¨æœ¬åœ° Mock API (`server/api/` ç›®éŒ„)
- âœ… `false`ï¼šä½¿ç”¨é ç«¯ API (`NUXT_PUBLIC_API_BASE_URL/xxx`)

> ğŸ’¡ **é–‹ç™¼æç¤º**ï¼šæœ¬åœ° API æ¨¡å¼ä¸‹ï¼Œ`server/api/` ç›®éŒ„å……ç•¶ Mock æœå‹™å™¨ï¼Œé©åˆå‰ç«¯é–‹ç™¼éšæ®µä½¿ç”¨ã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

```bash
# å®‰è£ä¾è³´
npm install

# å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
npm run dev
```

## ğŸ”§ ç’°å¢ƒé…ç½®

### å¿…è¦ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸åç¨±                       | èªªæ˜                  | ç¯„ä¾‹å€¼                       |
| ------------------------------ | --------------------- | ---------------------------- |
| `NUXT_API_ENV`                 | ç’°å¢ƒè­˜åˆ¥              | `development` / `production` |
| `NUXT_PUBLIC_API_BASE_URL`     | é ç«¯ API åŸºç¤åœ°å€     | `https://api.example.com`    |
| `NUXT_PUBLIC_IS_USE_LOCAL_API` | æ˜¯å¦ä½¿ç”¨æœ¬åœ° API      | `true` / `false`             |
| `NUXT_PUBLIC_IS_SHOW_CONSOLE`  | æ˜¯å¦é¡¯ç¤º console é™¤éŒ¯ | `true` / `false`             |
| `NUXT_PUBLIC_API_TIMEOUT`      | API è¶…æ™‚æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰  | `5000`                       |

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
â”œâ”€â”€ .env.example           # ç¯„ä¾‹æª”æ¡ˆï¼ˆGit è¿½è¹¤ï¼‰
â”œâ”€â”€ .env.development       # é–‹ç™¼ç’°å¢ƒè¨­å®šï¼ˆæ­£å¼é–‹ç™¼æ™‚å»ºç«‹ï¼ŒGit ä¸è¿½è¹¤ï¼‰
â”œâ”€â”€ .env.production        # ç”Ÿç”¢ç’°å¢ƒè¨­å®šï¼ˆæ­£å¼é–‹ç™¼æ™‚å»ºç«‹ï¼ŒGit ä¸è¿½è¹¤ï¼‰
â”œâ”€â”€ assets/css/            # å…¨åŸŸæ¨£å¼
â”œâ”€â”€ components/            # çµ„ä»¶
â”‚   â”œâ”€â”€ shared/           # é€šç”¨çµ„ä»¶
â”‚   â””â”€â”€ user/             # ç”¨æˆ¶ç›¸é—œçµ„ä»¶
â”œâ”€â”€ composables/           # çµ„åˆå‡½æ•¸
â”œâ”€â”€ pages/                 # é é¢è·¯ç”±
â”œâ”€â”€ server/api/            # ä¼ºæœå™¨ç«¯ API è·¯ç”±
â”œâ”€â”€ service/               # æœå‹™å±¤
â”‚   â”œâ”€â”€ api/              # API æœå‹™
â”‚   â””â”€â”€ schema/           # è³‡æ–™é©—è­‰ Schema
â””â”€â”€ types/                # å‹åˆ¥å®šç¾©
```

## ğŸŒŸ åŠŸèƒ½ç‰¹è‰²

### 1. å®Œæ•´çš„è³‡æ–™æµæ¶æ§‹

- **Schema é©—è­‰**ï¼šä½¿ç”¨ Zod ç¢ºä¿è³‡æ–™å‹åˆ¥å®‰å…¨
- **API æœå‹™**ï¼šçµ±ä¸€çš„ API å‘¼å«ç®¡ç†
- **çµ„ä»¶åŒ–è¨­è¨ˆ**ï¼šå¯é‡ç”¨çš„ Vue çµ„ä»¶
- **éŸ¿æ‡‰å¼ç‹€æ…‹**ï¼šä½¿ç”¨ Composables ç®¡ç†ç‹€æ…‹

### 2. é–‹ç™¼é«”é©—å„ªåŒ–

- **TypeScript**ï¼šå®Œæ•´çš„å‹åˆ¥æª¢æŸ¥
- **ESLint**ï¼šç¨‹å¼ç¢¼å“è³ªä¿è­‰
- **æ‰‹å‹•å°å…¥**ï¼šæ˜ç¢ºçš„ä¾è³´ç®¡ç†
- **ç’°å¢ƒé…ç½®**ï¼šå¤šç’°å¢ƒæ”¯æ´

### 3. ç¤ºä¾‹é é¢

- **é¦–é **ï¼šå°ˆæ¡ˆæ¦‚è¦½å’Œå°èˆª
- **è³‡æ–™æµç¤ºä¾‹**ï¼šå®Œæ•´çš„ CRUD æ“ä½œå±•ç¤º

## ğŸ“‹ é–‹ç™¼è¦ç¯„

### 1. çµ„ä»¶è¨­è¨ˆåŸå‰‡

```typescript
// çµ„ä»¶å‹åˆ¥å®šç¾©åœ¨ .vue æª”æ¡ˆä¸­
interface Props {
  data: DataType[]
  loading?: boolean
}

interface Emits {
  update: [data: DataType]
}
```

### 2. è³‡æ–™é©—è­‰æµç¨‹

```typescript
// 1. å®šç¾© Schema
export const UserSchema = z.object({
  id: z.number(),
  name: z.string(),
  email: z.string().email(),
})

// 2. åœ¨ API æœå‹™ä¸­ä½¿ç”¨ (é è¨­ throwOnError: true)
export class UserApi {
  async getUsers(): Promise<User[]> {
    try {
      const response = await $fetch('/api/users')
      const result = validateSchema(UserListSchema, response)
      return result.data // é©—è­‰æˆåŠŸæ‰æœƒåˆ°é”é€™è£¡
    }
    catch (error) {
      // é©—è­‰å¤±æ•—æœƒæ‹‹å‡ºç•°å¸¸
      throw new Error('API é©—è­‰å¤±æ•—')
    }
  }

  // ç‰¹æ®Šæƒ…æ³ï¼šéœ€è¦æª¢æŸ¥é©—è­‰çµæœè€Œéæ•æ‰ç•°å¸¸
  validateUserInput(data: unknown) {
    const result = validateSchema(UserSchema, data, { throwOnError: false })
    if (result.success) {
      return result.data
    }
    else {
      return result.errors // è¿”å›è©³ç´°éŒ¯èª¤ä¿¡æ¯
    }
  }
}
```

### 3. é©—è­‰ç³»çµ±è¨­è¨ˆ

- **é è¨­è¡Œç‚º**ï¼š`throwOnError: true` - é©—è­‰å¤±æ•—æ™‚æ‹‹å‡ºç•°å¸¸
- **ç•°å¸¸è™•ç†**ï¼šAPI å±¤ä½¿ç”¨ try/catch è™•ç†é©—è­‰éŒ¯èª¤
- **éŒ¯èª¤æ”¶é›†**ï¼šç‰¹æ®Šéœ€æ±‚æ™‚è¨­å®š `throwOnError: false` æ”¶é›†éŒ¯èª¤è©³æƒ…
- **æ‰¹é‡é©—è­‰**ï¼š`validateMultiple` å…§éƒ¨æ”¶é›†æ‰€æœ‰éŒ¯èª¤å¾Œæ ¹æ“šè¨­å®šæ±ºå®šè¡Œç‚º

### 4. çµ„ä»¶åˆ†çµ„ç­–ç•¥

```
components/
â”œâ”€â”€ shared/          # é€šç”¨çµ„ä»¶
â”œâ”€â”€ user/            # ç”¨æˆ¶ç›¸é—œçµ„ä»¶
â”œâ”€â”€ product/         # å•†å“ç›¸é—œçµ„ä»¶ï¼ˆç¤ºä¾‹ï¼‰
â””â”€â”€ order/           # è¨‚å–®ç›¸é—œçµ„ä»¶ï¼ˆç¤ºä¾‹ï¼‰
```

## ğŸ”§ é–‹ç™¼å·¥å…·

### ç’°å¢ƒè®Šæ•¸ç®¡ç†

åŸºç¤è¨­å®šåœ¨ `.env`ï¼Œé–‹ç™¼æ™‚æœƒä»¥ `.env.development` è¦†è“‹è¨­å®šï¼š

```bash
# é–‹ç™¼æ¨¡å¼æ™‚è®€å–é †åºï¼š.env â†’ .env.development
npm run dev  # ä½¿ç”¨ --dotenv .env.development
```

### å»ºç½®èˆ‡éƒ¨ç½²

```bash
# é–‹ç™¼ç’°å¢ƒ
npm run dev

# ç”Ÿç”¢ç’°å¢ƒ
npm run build
npm run start
```

### Service å±¤ä½¿ç”¨

```typescript
// è¼‰å…¥ API æœå‹™
import { userApi } from '~/service/api/user'

// å–å¾—ç”¨æˆ¶åˆ—è¡¨ï¼ˆæ ¹æ“š NUXT_PUBLIC_IS_USE_LOCAL_API è‡ªå‹•åˆ‡æ› Mock/é ç«¯ APIï¼‰
const users = await userApi.getUsers()

// å»ºç«‹ç”¨æˆ¶ï¼ˆæ–¹æ³•å…§éƒ¨æœƒé©—è­‰APIå›å‚³è³‡æ–™ï¼‰
const newUser = await userApi.createUser({
  name: 'John',
  email: 'john@example.com'
})
```

## ğŸš¨ å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼è¦ç¦ç”¨è‡ªå‹•å°å…¥ï¼Ÿ

A: ç‚ºäº†æé«˜å¤§å‹å°ˆæ¡ˆçš„å¯ç¶­è­·æ€§ï¼Œè®“ä¾è³´é—œä¿‚æ›´æ˜ç¢ºã€‚

### Q: ç’°å¢ƒè®Šæ•¸æ²’æœ‰ç”Ÿæ•ˆæ€éº¼è¾¦ï¼Ÿ

A: 1. æª¢æŸ¥æª”æ¡ˆåç¨±æ˜¯å¦æ­£ç¢º 2. é‡æ–°å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ 3. ç¢ºèªè®Šæ•¸åç¨±æ²’æœ‰æ‹¼å¯«éŒ¯èª¤

### Q: API åˆ‡æ›ä¸ç”Ÿæ•ˆï¼Ÿ

A: ç¢ºèª `NUXT_PUBLIC_IS_USE_LOCAL_API` è¨­å®šæ­£ç¢ºï¼Œä¸¦é‡æ–°å•Ÿå‹•ä¼ºæœå™¨ã€‚

### Q: å¦‚ä½•åœ¨é–‹ç™¼éšæ®µä½¿ç”¨ Mock APIï¼Ÿ

A: è¨­å®š `NUXT_PUBLIC_IS_USE_LOCAL_API=true`ï¼Œç³»çµ±æœƒè‡ªå‹•ä½¿ç”¨ `server/api/` ç›®éŒ„ä¸‹çš„è·¯ç”±ä½œç‚º Mock APIã€‚

---
